const rawData =
    `qid;q_text;Overall;United States;United Kingdom;Japan;Canada;Australia;Germany;Netherlands;Indonesia;Ireland;Italy;Sweden;New Zealand;Finland;Spain;Israel;Argentina;France;Thailand;South Africa;Brazil;Mexico;Russia;South Korea;Nigeria;Portugal;Male;Female;iPhone;Android
1;"Held hands, romantically?";74.75%;83.48%;78.61%;40.11%;76.38%;71.47%;72.99%;75.86%;57.67%;72.06%;79.84%;68.40%;73.55%;73.46%;79.56%;72.60%;81.42%;82.54%;55.79%;81.42%;82.94%;84.26%;83.07%;63.91%;78.51%;81.19%;75.32%;72.74%;77.90%;72.69%
2;Been on a date?;66.52%;76.20%;69.25%;54.13%;69.21%;62.30%;65.49%;71.29%;52.63%;61.59%;69.11%;59.71%;64.37%;60.01%;71.81%;66.13%;73.20%;76.98%;39.56%;64.57%;68.48%;76.29%;68.83%;70.88%;49.32%;68.45%;67.74%;63.19%;70.39%;63.44%
3;Been in a relationship?;73.27%;84.23%;76.21%;54.11%;75.41%;71.38%;66.32%;73.75%;59.64%;73.10%;74.24%;70.57%;75.04%;68.28%;70.52%;61.20%;71.48%;82.12%;61.75%;80.18%;65.13%;79.33%;75.83%;68.42%;65.90%;71.57%;74.80%;71.66%;76.35%;71.60%
4;Danced withoutleaving room for Jesus?;55.75%;66.01%;62.92%;22.95%;60.27%;55.04%;60.83%;62.79%;28.14%;59.97%;59.40%;61.73%;56.12%;57.23%;69.34%;55.43%;68.63%;66.28%;21.60%;65.42%;60.13%;61.34%;27.00%;26.59%;54.29%;58.70%;56.52%;52.14%;59.41%;53.31%
5;Kissed a non-family member?;78.52%;85.15%;84.14%;50.70%;81.13%;76.77%;83.22%;81.79%;52.55%;85.42%;90.41%;81.89%;79.96%;86.39%;90.98%;75.48%;92.08%;88.49%;58.89%;84.65%;90.60%;89.14%;82.46%;68.42%;85.02%;89.39%;77.95%;76.21%;82.03%;76.87%
6;Kissed a non-family member on the lips?;74.06%;82.77%;80.87%;48.30%;76.74%;70.58%;80.17%;77.93%;43.78%;81.93%;86.79%;77.52%;74.83%;83.97%;88.17%;71.48%;89.84%;86.24%;41.14%;82.24%;88.06%;85.87%;81.23%;61.25%;80.68%;82.21%;73.66%;70.25%;78.60%;71.16%
7;French kissed?;61.38%;70.92%;67.28%;39.34%;62.23%;55.24%;65.41%;67.01%;37.17%;74.89%;77.33%;60.48%;59.22%;67.16%;72.72%;62.16%;74.89%;74.32%;28.67%;71.35%;77.68%;74.11%;72.01%;56.34%;63.46%;67.95%;61.63%;56.88%;66.42%;57.74%
8;French kissed in public?;46.96%;55.00%;57.48%;18.22%;49.18%;44.37%;50.55%;53.98%;14.85%;68.04%;72.20%;46.08%;46.51%;52.35%;64.20%;52.67%;62.75%;60.12%;16.01%;59.46%;68.73%;56.66%;54.09%;24.03%;38.05%;59.16%;47.69%;42.04%;51.01%;44.33%
9;Kissed on the neck?;61.84%;71.89%;68.49%;31.89%;63.43%;57.41%;64.22%;66.13%;42.68%;60.49%;75.09%;57.13%;61.34%;61.41%;75.91%;59.43%;75.27%;76.15%;33.26%;72.43%;74.81%;75.56%;74.96%;52.85%;60.59%;72.72%;63.26%;59.14%;65.65%;59.57%
10;Kissed horizontally?;57.39%;68.08%;63.63%;37.86%;60.92%;53.90%;51.90%;61.55%;36.80%;59.54%;67.53%;56.59%;56.54%;60.12%;67.05%;57.72%;63.79%;72.63%;25.91%;62.11%;67.83%;62.30%;68.85%;56.01%;46.31%;65.50%;57.76%;52.65%;62.32%;53.35%
11;Given or received a love bite?;54.49%;64.97%;58.77%;29.75%;56.99%;48.43%;55.97%;53.50%;33.81%;53.47%;64.60%;50.16%;52.90%;55.11%;69.85%;54.04%;71.94%;76.76%;32.79%;64.71%;72.85%;71.03%;68.69%;57.34%;37.44%;67.04%;56.52%;53.04%;58.11%;52.58%
12;Kissed or been kissed on the breast?;52.30%;64.20%;58.68%;28.70%;55.99%;47.08%;55.63%;54.06%;34.60%;49.87%;64.78%;48.07%;50.46%;54.15%;62.14%;50.28%;60.93%;68.23%;28.46%;59.46%;61.78%;61.00%;66.42%;53.80%;52.24%;59.29%;53.62%;49.25%;56.79%;49.76%
13;Kissed someone below the belt?;45.03%;58.04%;50.59%;26.63%;49.00%;40.84%;44.73%;44.09%;28.97%;38.66%;56.02%;38.85%;44.44%;42.82%;54.89%;43.38%;54.93%;62.07%;20.61%;48.05%;54.19%;58.54%;58.45%;43.86%;44.28%;52.08%;49.58%;43.28%;48.08%;43.58%
14;Kissed more than one person at a time?;24.09%;28.29%;31.93%;14.22%;26.94%;23.85%;19.60%;28.62%;11.25%;27.86%;27.62%;26.83%;27.63%;26.40%;31.88%;24.68%;39.96%;33.02%;7.44%;27.02%;35.25%;38.01%;25.98%;10.40%;19.10%;32.66%;24.46%;24.90%;25.54%;23.64%
15;Played a game involving stripping?;30.55%;38.95%;35.98%;13.14%;36.51%;33.69%;39.68%;33.15%;18.41%;29.41%;26.72%;30.80%;36.06%;44.74%;47.43%;29.75%;27.65%;48.78%;12.55%;35.81%;21.19%;30.23%;30.99%;14.60%;25.00%;38.22%;34.11%;29.43%;31.11%;30.57%
16;Masturbated to a picture or video?;76.06%;84.15%;79.14%;65.54%;78.44%;69.81%;79.07%;75.96%;67.39%;73.12%;81.09%;80.28%;72.40%;80.33%;82.12%;77.68%;83.26%;80.68%;74.88%;77.75%;75.10%;86.24%;84.04%;81.51%;67.69%;76.06%;82.68%;73.86%;76.17%;78.34%
17;Masturbated while someone else was in the room?;50.60%;61.49%;52.61%;32.45%;53.07%;44.32%;49.13%;50.36%;33.16%;46.94%;57.75%;47.74%;51.26%;48.85%;55.80%;52.95%;57.59%;57.45%;47.31%;51.61%;54.14%;59.94%;57.10%;41.29%;43.23%;49.46%;56.52%;51.70%;49.83%;54.28%
18;Helped someone masturbate?;47.71%;59.90%;53.25%;27.81%;50.63%;42.47%;48.12%;49.24%;31.77%;44.36%;57.62%;45.22%;45.82%;48.79%;61.33%;49.48%;56.71%;60.76%;24.83%;47.87%;58.48%;64.67%;61.51%;37.20%;39.78%;54.36%;50.87%;45.97%;50.44%;47.04%
19;Been caught masturbating?;28.11%;38.01%;29.82%;13.90%;32.55%;28.36%;25.46%;28.43%;17.24%;23.58%;27.79%;30.22%;28.60%;25.34%;28.88%;31.14%;31.47%;25.69%;15.71%;23.51%;26.22%;26.77%;19.32%;21.51%;15.68%;21.54%;34.57%;28.08%;26.50%;30.62%
20;Masturbated with an inanimate object?;53.40%;65.11%;55.88%;58.70%;57.53%;44.73%;59.98%;52.33%;29.58%;49.38%;57.18%;55.27%;51.17%;59.31%;59.11%;51.22%;55.20%;56.62%;36.20%;50.13%;53.99%;57.74%;57.33%;47.88%;37.70%;51.80%;54.14%;55.74%;53.50%;56.66%
21;Seen or read pornographic material?;88.03%;91.12%;88.93%;82.29%;88.45%;82.65%;91.69%;88.77%;85.56%;85.22%;91.94%;91.49%;88.61%;92.84%;92.16%;89.06%;91.56%;90.40%;91.42%;90.78%;88.90%;93.31%;94.06%;93.82%;94.97%;93.52%;91.02%;88.52%;87.65%;90.41%
22;Massaged or been massaged sensually?;53.38%;65.70%;56.73%;19.70%;56.73%;51.32%;43.86%;52.30%;34.85%;53.09%;62.81%;47.88%;52.98%;49.79%;62.04%;59.34%;62.68%;66.46%;25.98%;59.99%;57.51%;67.29%;64.71%;32.42%;46.37%;53.71%;56.76%;51.53%;56.70%;51.53%
23;Gone through the motions of intercourse whilst being fully dressed?;51.70%;62.92%;56.26%;22.34%;55.25%;47.00%;57.23%;52.37%;29.94%;48.59%;48.25%;48.92%;49.81%;58.55%;59.01%;52.75%;59.00%;69.34%;24.33%;54.84%;63.65%;59.48%;63.21%;39.02%;44.44%;53.71%;53.58%;48.76%;55.44%;49.43%
24;Undressed or been undressed by a MPS (member of the preferred sex)?;51.07%;62.99%;57.88%;30.01%;54.79%;47.15%;54.17%;51.18%;31.06%;46.08%;58.55%;50.27%;50.00%;51.15%;57.78%;51.33%;56.68%;68.61%;23.96%;54.38%;57.82%;59.83%;70.46%;52.65%;44.94%;55.91%;53.66%;48.74%;54.96%;48.98%
25;Showered with a MPS?;32.56%;43.96%;34.23%;26.54%;37.39%;32.53%;36.11%;36.75%;26.93%;23.33%;42.74%;37.29%;33.08%;43.27%;40.54%;34.72%;29.73%;55.91%;14.32%;33.67%;36.47%;31.68%;64.88%;43.64%;32.18%;36.78%;37.82%;32.64%;33.64%;32.54%
26;Fondled or had your butt cheeks fondled?;59.24%;70.19%;66.58%;43.66%;61.19%;56.21%;62.90%;56.32%;36.83%;62.18%;75.94%;50.77%;59.47%;54.46%;77.47%;59.76%;76.58%;73.75%;34.90%;63.68%;71.10%;73.30%;78.00%;32.08%;67.44%;64.73%;61.49%;57.24%;63.07%;57.65%
27;Fondled or had your breasts fondled?;60.37%;71.71%;65.71%;44.89%;62.29%;57.63%;62.89%;58.04%;37.45%;58.67%;71.72%;51.79%;59.82%;58.89%;72.45%;59.35%;72.58%;72.31%;42.94%;64.20%;68.47%;73.51%;77.87%;53.72%;58.68%;61.33%;61.63%;58.89%;64.26%;58.56%
28;Fondled or had your genitals fondled?;53.92%;66.50%;60.28%;37.57%;56.54%;50.44%;55.19%;51.02%;36.11%;50.48%;64.94%;44.82%;54.37%;51.57%;64.56%;52.53%;65.25%;69.42%;37.41%;57.95%;64.93%;67.20%;67.65%;54.97%;58.48%;55.07%;58.60%;51.99%;57.35%;52.52%
29;Heard of “blue balls”?;68.29%;86.12%;80.20%;76.62%;78.25%;78.35%;53.08%;69.37%;28.13%;74.77%;47.23%;75.16%;74.87%;66.29%;39.64%;75.66%;45.52%;67.04%;56.99%;80.78%;41.53%;57.26%;24.09%;14.05%;71.18%;56.97%;66.90%;59.86%;74.86%;60.41%
30;Had an orgasm due to someone else’s manipulation?;43.27%;56.17%;46.43%;24.89%;48.16%;38.18%;41.59%;43.03%;21.97%;40.72%;53.37%;40.10%;44.81%;37.31%;51.02%;44.24%;45.08%;57.16%;17.86%;42.89%;45.64%;53.20%;50.08%;38.28%;32.56%;47.09%;47.76%;41.48%;45.32%;42.67%
31;Tried sexting with any stranger(s)?;43.84%;54.12%;51.11%;23.80%;47.96%;45.11%;57.70%;43.23%;26.82%;48.77%;47.05%;46.03%;50.47%;43.28%;28.50%;47.16%;26.91%;46.32%;9.79%;48.20%;27.50%;28.50%;20.70%;23.89%;54.12%;35.42%;45.30%;40.85%;46.44%;43.27%
32;Sent or received sexually explicit photographs?;67.64%;79.50%;75.25%;33.99%;72.38%;70.16%;69.21%;67.66%;48.56%;70.30%;63.65%;70.37%;72.54%;71.13%;66.65%;63.16%;71.81%;68.03%;54.46%;75.36%;65.71%;76.24%;71.12%;38.97%;70.35%;65.70%;68.90%;65.70%;71.61%;65.60%
33;Engaged in sexually explicit activity over video chat?;36.04%;52.66%;39.90%;13.90%;40.48%;35.67%;23.86%;31.82%;27.46%;32.58%;24.28%;28.57%;37.15%;27.01%;35.27%;33.33%;35.90%;35.66%;22.46%;39.30%;28.85%;45.70%;22.03%;18.21%;43.53%;25.33%;39.95%;33.79%;38.20%;34.36%
34;Cheated on a significant other during a relationship?;19.98%;30.04%;17.33%;13.53%;20.60%;16.16%;13.85%;15.44%;15.15%;18.36%;16.49%;13.47%;20.44%;13.74%;17.07%;11.21%;22.38%;23.45%;16.90%;27.30%;12.74%;32.15%;20.75%;14.01%;29.65%;14.21%;22.47%;21.05%;20.76%;19.62%
35;Purchased contraceptives?;34.61%;45.01%;41.16%;24.24%;40.04%;35.08%;42.05%;35.14%;17.52%;32.20%;45.24%;35.46%;38.56%;34.06%;41.90%;31.04%;42.92%;58.32%;14.88%;34.94%;33.61%;50.10%;32.55%;34.28%;18.34%;42.51%;40.46%;33.17%;36.44%;34.37%
36;Given oral sex?;43.82%;58.06%;48.59%;29.29%;47.73%;39.39%;42.76%;41.51%;24.01%;38.30%;55.10%;36.93%;42.66%;42.29%;52.65%;42.59%;52.72%;57.70%;19.28%;46.84%;50.96%;56.76%;57.31%;41.14%;44.58%;46.40%;48.76%;43.07%;46.60%;42.72%
37;Received oral sex?;43.92%;58.06%;48.00%;27.88%;47.49%;38.78%;43.18%;41.57%;24.98%;38.48%;54.41%;38.33%;41.49%;43.39%;53.41%;40.79%;52.13%;58.68%;20.42%;47.05%;50.00%;53.34%;55.82%;40.92%;50.92%;44.65%;49.62%;41.85%;46.62%;42.69%
38;Ingested someone else’s genital secretion?;36.22%;49.36%;41.63%;23.49%;40.41%;31.97%;38.75%;34.49%;16.27%;31.17%;41.85%;32.88%;37.74%;32.05%;41.67%;36.64%;42.97%;41.67%;11.23%;36.74%;36.94%;44.44%;38.67%;25.07%;27.11%;32.43%;39.89%;35.60%;38.64%;35.62%
39;Used a sex toy with a partner?;20.27%;35.26%;21.23%;19.58%;26.52%;15.32%;19.56%;21.28%;8.07%;13.34%;20.76%;20.70%;20.04%;18.94%;21.82%;17.10%;15.67%;29.56%;6.30%;13.04%;15.52%;15.80%;24.50%;26.50%;10.91%;10.87%;26.83%;21.98%;19.80%;22.00%
40;Spent the night with a MPS?;47.61%;58.49%;54.01%;31.42%;52.27%;48.19%;57.43%;53.14%;27.80%;42.09%;59.93%;56.50%;51.73%;59.05%;52.77%;49.34%;50.21%;70.46%;18.53%;49.42%;49.75%;38.01%;62.90%;50.00%;33.94%;51.94%;51.29%;45.68%;49.83%;46.63%
41;Been walked in on while engaging in a sexual act?;27.98%;39.45%;33.84%;13.52%;32.61%;30.36%;22.72%;27.99%;10.80%;29.48%;24.50%;28.50%;33.50%;28.71%;25.55%;31.57%;26.17%;37.27%;9.72%;31.06%;31.39%;23.97%;29.54%;9.80%;22.09%;23.77%;28.58%;25.31%;30.85%;26.03%
42;Kicked a roommate out to commit a sexual act?;19.49%;28.25%;20.82%;9.87%;21.66%;18.62%;12.37%;15.19%;10.33%;19.09%;22.61%;15.13%;20.87%;13.24%;24.17%;19.16%;23.11%;16.32%;7.93%;21.65%;18.72%;25.49%;17.94%;8.95%;19.02%;16.51%;21.04%;17.24%;21.48%;17.80%
43;Had sexual intercourse?;44.12%;58.42%;48.97%;32.36%;48.07%;38.98%;44.87%;42.60%;26.49%;37.05%;54.08%;43.43%;46.45%;48.67%;51.50%;38.97%;53.88%;63.31%;22.61%;43.07%;48.83%;52.53%;63.58%;49.88%;34.78%;47.23%;49.28%;43.71%;46.72%;43.47%
44;Had sexual intercourse three or more times in one night?;28.10%;41.92%;32.05%;16.43%;33.52%;24.17%;27.89%;28.58%;17.66%;24.17%;28.37%;29.30%;33.29%;27.88%;32.67%;26.96%;34.85%;41.21%;11.90%;26.90%;23.97%;27.72%;39.29%;30.45%;13.75%;25.45%;33.07%;27.95%;29.78%;27.96%
45;Had sexual intercourse ten or more times?;27.72%;40.55%;30.84%;18.51%;32.92%;22.84%;32.47%;29.37%;12.54%;23.48%;38.44%;29.18%;30.65%;32.44%;35.29%;26.05%;34.31%;47.51%;9.33%;23.43%;24.53%;27.03%;40.55%;27.07%;18.59%;27.34%;33.45%;28.31%;28.44%;27.99%
46;Had sexual intercourse in four or more different positions?;35.53%;49.93%;39.12%;19.47%;40.53%;29.92%;34.94%;35.60%;20.98%;28.92%;44.60%;38.56%;37.61%;38.19%;42.94%;31.35%;44.53%;50.96%;16.67%;33.11%;37.20%;43.71%;50.91%;36.52%;21.43%;36.74%;41.35%;35.54%;37.37%;35.24%
47;Had sexual intercourse with a stranger or person you met within 24 hours?;17.30%;27.21%;20.03%;15.66%;20.29%;13.92%;15.58%;17.61%;9.15%;16.24%;15.86%;22.14%;21.21%;19.56%;21.90%;16.86%;16.77%;27.79%;6.88%;14.80%;17.37%;20.62%;19.49%;21.90%;12.00%;15.66%;21.92%;17.31%;18.26%;17.03%
48;Had sexual intercourse in a motor vehicle?;21.00%;40.52%;15.84%;12.99%;26.62%;16.17%;13.26%;15.25%;11.96%;12.62%;28.01%;15.22%;23.56%;15.91%;20.81%;19.03%;18.13%;27.12%;4.23%;18.23%;15.93%;20.97%;21.59%;20.44%;8.44%;20.11%;25.51%;20.79%;23.64%;19.53%
49;Had sexual intercourse outdoors?;24.54%;37.29%;26.45%;11.18%;29.20%;20.84%;27.73%;25.50%;10.12%;22.09%;37.17%;22.36%;28.40%;22.68%;34.70%;24.76%;23.79%;39.51%;5.70%;21.03%;24.21%;24.44%;28.90%;17.22%;21.85%;31.40%;30.23%;24.16%;25.34%;25.41%
50;Had sexual intercourse in public?;20.71%;33.04%;23.25%;9.62%;24.81%;17.75%;20.97%;20.92%;6.65%;18.87%;32.05%;18.34%;23.79%;17.49%;27.90%;18.39%;22.32%;26.01%;8.01%;17.77%;20.25%;18.15%;11.60%;6.84%;20.39%;21.79%;25.01%;20.29%;21.87%;20.69%
51;Had sexual intercourse in a swimming pool or hot tub?;13.60%;22.19%;9.70%;7.28%;16.72%;12.30%;12.17%;14.55%;8.43%;6.11%;23.95%;14.61%;18.18%;11.34%;25.54%;15.32%;22.72%;31.33%;7.91%;13.70%;12.45%;18.44%;15.49%;26.17%;4.83%;12.96%;18.48%;14.35%;13.12%;14.37%
52;Had sexual intercourse in a bed not belonging to you or your partner?;30.66%;43.46%;31.87%;21.98%;33.67%;24.88%;24.75%;30.62%;19.79%;26.28%;43.86%;30.44%;32.82%;33.00%;40.14%;25.15%;41.64%;46.84%;12.35%;32.30%;36.33%;42.01%;49.72%;35.24%;22.45%;33.10%;36.97%;31.64%;31.84%;30.86%
53;Had sexual intercourse while you or your partner’s parents were in the same home?;32.84%;48.30%;38.63%;13.90%;40.05%;29.83%;15.26%;33.89%;15.25%;29.44%;42.61%;36.60%;37.75%;37.42%;37.41%;36.35%;44.78%;48.58%;11.02%;30.27%;36.74%;35.29%;40.08%;14.10%;12.41%;31.41%;37.21%;31.49%;35.24%;31.87%
54;Had sexual intercourse with a non-participating third party in the same room?;12.25%;20.83%;12.24%;8.34%;14.03%;10.45%;9.31%;9.68%;5.64%;9.77%;10.74%;13.62%;16.79%;12.00%;9.92%;9.66%;15.09%;19.11%;5.36%;12.53%;13.18%;13.40%;13.63%;5.94%;8.97%;6.32%;15.64%;12.57%;12.41%;12.52%
55;Had a threesome?;8.10%;14.82%;6.55%;9.11%;8.94%;7.36%;5.94%;7.03%;5.11%;4.94%;7.81%;9.43%;10.17%;5.98%;8.54%;9.66%;9.03%;11.69%;2.82%;6.58%;10.04%;10.41%;10.76%;6.08%;7.38%;4.62%;11.61%;9.03%;7.25%;9.09%
56;Attended an orgy?;4.40%;6.50%;3.63%;6.21%;4.66%;4.50%;2.98%;3.22%;3.27%;3.21%;3.11%;5.85%;5.64%;4.88%;2.85%;5.72%;3.92%;5.10%;8.99%;5.52%;5.27%;3.74%;4.05%;8.99%;4.67%;1.84%;5.89%;4.47%;3.91%;4.46%
57;Had two or more distinct acts of sexual intercourse with two or more people within 24 hours?;11.88%;20.61%;12.37%;10.40%;14.49%;10.37%;8.75%;10.21%;5.91%;10.08%;10.70%;14.72%;13.29%;10.52%;12.25%;16.93%;13.34%;17.40%;2.90%;9.89%;11.87%;14.14%;11.08%;9.57%;19.33%;9.21%;15.48%;11.67%;12.31%;11.81%
58;Had sexual intercourse with five or more partners?;13.13%;24.39%;13.14%;13.91%;16.42%;9.94%;9.03%;11.81%;5.41%;11.28%;13.65%;17.41%;14.88%;13.10%;14.17%;13.21%;14.24%;24.92%;2.88%;10.30%;10.06%;17.21%;13.53%;8.04%;18.24%;11.84%;18.41%;13.65%;13.49%;13.18%
59;Been photographed or filmed during sexual intercourse by yourself or others?;21.92%;35.92%;22.04%;15.23%;24.55%;18.17%;16.49%;17.21%;15.39%;15.69%;20.49%;22.52%;23.62%;17.63%;19.87%;16.93%;30.09%;24.14%;11.84%;19.33%;18.06%;28.59%;28.77%;12.90%;16.89%;15.98%;25.56%;22.44%;23.08%;21.81%
60;Had period sex?;26.14%;39.44%;28.23%;14.46%;30.58%;19.27%;27.21%;26.22%;15.87%;19.73%;33.08%;26.33%;28.53%;29.33%;33.01%;20.40%;30.98%;40.80%;11.45%;23.08%;25.75%;28.48%;42.25%;23.90%;14.77%;27.05%;30.18%;27.24%;27.61%;26.40%
61;Had anal sex?;18.39%;30.56%;18.77%;11.15%;21.04%;12.76%;18.01%;16.25%;12.17%;14.90%;21.67%;18.00%;18.42%;18.62%;21.46%;15.48%;21.44%;28.68%;5.96%;15.66%;18.48%;22.47%;23.40%;13.86%;8.84%;14.51%;26.00%;19.99%;17.31%;20.64%
62;Had a pregnancy scare?;32.14%;42.84%;33.34%;16.26%;35.25%;27.23%;37.05%;28.59%;22.14%;30.58%;38.96%;32.97%;34.80%;34.73%;28.94%;24.80%;32.97%;43.90%;27.13%;32.93%;32.68%;37.08%;52.26%;51.19%;33.77%;30.72%;34.52%;32.80%;34.47%;31.26%
63;Impregnated someone or been impregnated?;7.44%;14.47%;7.13%;6.72%;8.88%;7.86%;4.45%;3.95%;5.33%;3.55%;4.49%;7.16%;9.67%;4.31%;4.22%;5.42%;3.40%;12.51%;2.53%;5.87%;4.30%;5.39%;25.40%;6.51%;8.72%;4.22%;10.23%;7.96%;6.87%;8.19%
64;Paid or been paid for a sexual act?;8.15%;12.22%;7.42%;12.93%;8.92%;9.13%;5.85%;5.20%;7.82%;6.02%;6.26%;8.44%;9.67%;4.70%;8.57%;8.03%;7.52%;7.20%;5.68%;6.48%;5.34%;9.44%;8.59%;5.18%;14.97%;2.93%;11.56%;8.45%;7.62%;8.52%
65;Committed an act of voyeurism?;14.33%;20.49%;14.50%;12.49%;14.10%;14.39%;8.89%;13.96%;8.83%;9.83%;12.50%;13.34%;13.01%;12.49%;16.78%;10.43%;18.11%;21.16%;10.55%;12.73%;13.28%;16.51%;25.18%;17.80%;18.62%;13.70%;18.46%;15.26%;13.22%;15.35%
66;Committed an act of incest?;5.92%;8.09%;3.57%;5.46%;5.67%;5.06%;3.35%;3.59%;3.25%;4.73%;5.56%;5.78%;6.54%;3.52%;8.03%;5.04%;13.77%;5.97%;0.80%;9.15%;9.57%;11.27%;4.13%;2.47%;17.12%;6.15%;7.59%;7.25%;4.87%;6.68%
67;Engaged in bestiality?;4.00%;4.98%;1.52%;3.52%;3.59%;0.56%;11.33%;1.52%;2.46%;3.02%;3.73%;3.50%;3.84%;2.41%;7.72%;2.22%;7.54%;4.15%;2.24%;4.06%;5.71%;6.17%;3.21%;10.74%;4.83%;3.24%;5.14%;4.47%;3.07%;4.57%
68;Ingested alcohol in a non-religious context?;68.92%;76.64%;81.85%;14.11%;75.03%;68.34%;78.08%;68.49%;36.23%;76.52%;81.36%;67.47%;73.54%;74.87%;78.99%;72.90%;78.18%;76.56%;44.74%;74.58%;76.91%;75.15%;68.65%;58.93%;58.62%;78.55%;69.73%;65.47%;71.85%;67.98%
69;Have you ever done a 69?;57.96%;61.57%;73.32%;19.97%;64.45%;61.88%;75.08%;61.49%;27.25%;62.36%;68.64%;54.12%;68.69%;63.13%;75.10%;57.46%;67.80%;70.05%;31.54%;65.53%;50.72%;64.77%;51.40%;65.67%;35.17%;67.85%;58.75%;53.57%;62.01%;55.37%
70;Been drunk?;62.05%;66.01%;77.53%;48.48%;66.36%;59.93%;74.36%;60.20%;34.25%;68.26%;70.14%;57.43%;68.79%;68.82%;73.63%;66.80%;71.06%;70.32%;41.44%;67.63%;59.88%;70.55%;75.45%;71.09%;39.46%;64.24%;63.25%;60.04%;65.76%;60.97%
71;Faked sobriety in front of parents or teachers?;53.23%;57.29%;66.08%;20.75%;56.27%;49.21%;65.31%;54.46%;28.47%;60.06%;63.34%;47.82%;58.62%;56.18%;62.47%;54.85%;59.27%;56.47%;27.27%;62.74%;51.68%;60.06%;63.56%;50.51%;31.97%;57.27%;51.42%;49.55%;57.71%;50.65%
72;Had severe memory loss due to alcohol?;34.40%;35.61%;49.71%;15.82%;37.83%;35.54%;50.56%;39.55%;12.96%;41.66%;40.55%;35.20%;41.75%;43.52%;44.63%;36.51%;32.49%;39.36%;11.76%;40.66%;33.41%;36.72%;48.01%;41.34%;16.89%;39.18%;34.11%;30.26%;38.53%;32.31%
73;Used tobacco?;42.85%;48.95%;51.36%;22.56%;42.80%;40.17%;60.18%;43.73%;18.71%;52.98%;67.05%;48.74%;45.41%;48.21%;58.41%;41.46%;48.88%;60.64%;19.87%;56.50%;36.37%;53.55%;69.21%;43.69%;14.97%;54.30%;45.82%;40.59%;45.11%;42.88%
74;Used marijuana?;42.33%;62.47%;45.00%;5.90%;54.90%;38.32%;44.99%;41.41%;9.05%;39.38%;49.06%;27.57%;49.81%;26.95%;45.99%;38.22%;46.32%;50.20%;11.99%;57.23%;32.90%;47.04%;31.44%;6.76%;21.38%;37.00%;45.61%;37.63%;47.48%;39.42%
75;Used a drug stronger than marijuana?;18.45%;29.00%;23.06%;4.22%;24.31%;19.78%;17.82%;22.22%;4.85%;19.24%;14.71%;15.18%;25.19%;10.95%;15.93%;13.96%;13.91%;20.78%;3.90%;18.82%;15.95%;14.55%;17.48%;2.74%;8.84%;12.56%;22.62%;15.95%;20.28%;17.46%
76;"Used methamphetamine, crack, cocaine, PCP, horse tranquilizers or heroin?";9.84%;13.36%;15.75%;3.47%;11.06%;12.36%;8.76%;11.49%;2.89%;12.99%;6.56%;8.33%;12.61%;4.81%;7.10%;8.30%;4.80%;11.33%;1.95%;7.52%;6.39%;8.35%;10.02%;5.31%;8.84%;4.35%;12.21%;8.62%;10.63%;9.02%
77;"Been sent to the office of a principal, dean or judicial affairs representative for a disciplinary infraction?";38.34%;50.69%;39.04%;19.01%;43.34%;45.41%;23.15%;33.16%;19.88%;39.76%;23.97%;24.72%;50.08%;27.17%;36.75%;38.27%;39.07%;27.05%;20.90%;43.68%;38.07%;45.46%;28.28%;14.95%;40.00%;33.38%;45.04%;33.99%;39.83%;36.17%
78;Been put on disciplinary probation or suspended?;21.83%;33.15%;20.07%;6.00%;25.98%;29.46%;10.56%;17.06%;8.82%;18.34%;7.72%;10.08%;22.05%;11.52%;24.85%;24.63%;17.31%;25.79%;7.11%;17.47%;25.89%;34.83%;6.93%;4.28%;18.62%;13.12%;28.23%;18.86%;22.31%;20.34%
79;Urinated in front of anyone?;60.83%;66.93%;71.87%;27.65%;64.22%;62.07%;64.65%;57.66%;22.04%;69.63%;67.55%;65.66%;67.05%;70.67%;74.61%;60.72%;68.16%;66.08%;33.04%;68.36%;57.88%;49.63%;41.77%;29.73%;48.97%;72.31%;58.96%;53.35%;66.73%;55.47%
80;Urinated in public?;63.86%;67.29%;76.40%;29.29%;69.21%;65.95%;72.51%;69.96%;29.88%;75.48%;73.54%;64.97%;70.55%;72.00%;71.75%;71.25%;63.80%;63.67%;32.89%;64.55%;48.84%;45.72%;28.66%;31.88%;78.62%;68.33%;64.58%;55.76%;67.70%;61.01%
81;Taken a shower/bath with anyone older than 10 years of age?;41.52%;49.09%;42.11%;44.00%;41.87%;46.32%;28.61%;45.64%;27.03%;30.91%;33.92%;50.57%;48.96%;47.81%;53.79%;35.46%;40.42%;57.28%;35.75%;48.86%;46.94%;38.62%;52.61%;24.01%;39.16%;45.51%;43.40%;41.81%;42.92%;40.15%
82;Gone skinny-dipping?;29.10%;35.46%;23.93%;16.10%;37.38%;35.62%;41.67%;29.24%;13.65%;19.76%;32.86%;44.81%;42.42%;58.27%;48.10%;22.72%;26.52%;43.46%;13.30%;45.53%;22.36%;18.86%;66.05%;15.69%;7.69%;24.17%;30.22%;25.34%;31.68%;25.47%
83;Gone streaking (running naked through a public place)?;9.22%;12.50%;8.81%;7.43%;11.71%;15.52%;5.93%;7.73%;3.20%;7.22%;12.10%;10.01%;13.96%;13.34%;10.74%;10.40%;3.97%;14.93%;2.96%;10.60%;5.82%;5.14%;29.35%;3.10%;2.82%;4.10%;11.09%;8.09%;9.46%;8.15%
84;Seen a stripper?;29.04%;39.67%;24.58%;9.47%;32.07%;30.24%;32.62%;29.38%;22.70%;26.06%;23.90%;23.83%;32.23%;21.13%;20.80%;23.14%;17.44%;29.32%;20.00%;25.24%;14.27%;23.57%;82.58%;12.06%;25.17%;24.01%;32.75%;26.63%;29.91%;27.58%
85;Had the police called on you?;31.11%;42.14%;33.79%;10.98%;37.19%;33.79%;28.78%;29.94%;7.13%;37.46%;15.92%;23.64%;33.41%;27.05%;25.50%;35.71%;13.98%;20.46%;17.19%;18.03%;9.12%;11.25%;45.85%;9.35%;6.29%;18.97%;32.57%;23.79%;35.04%;26.41%
86;Run from the police?;25.85%;30.82%;28.94%;8.42%;29.84%;27.29%;31.85%;26.49%;9.20%;37.43%;20.43%;21.11%;23.88%;28.02%;36.46%;26.00%;21.25%;21.11%;6.16%;19.57%;10.57%;17.24%;24.73%;5.64%;9.15%;21.70%;25.73%;20.02%;29.00%;22.21%
87;Had the police question you?;38.28%;51.51%;41.09%;25.40%;42.41%;40.84%;29.56%;39.29%;18.25%;36.77%;24.14%;36.11%;42.22%;36.46%;30.38%;32.70%;20.13%;39.25%;10.80%;26.01%;17.10%;20.38%;36.27%;22.27%;23.24%;32.93%;42.54%;33.73%;40.81%;35.80%
88;Got handcuffed?;11.25%;20.00%;13.04%;4.78%;12.32%;11.29%;8.33%;7.88%;3.44%;9.31%;6.51%;8.54%;12.45%;8.16%;6.39%;8.53%;6.88%;11.66%;3.73%;8.59%;7.89%;5.24%;12.54%;5.61%;6.29%;5.02%;14.02%;10.31%;11.19%;11.01%
89;Been arrested?;5.71%;11.28%;5.74%;3.53%;6.32%;6.60%;4.29%;5.10%;2.13%;5.86%;1.91%;5.18%;5.36%;4.99%;3.41%;5.76%;1.64%;9.65%;4.20%;3.66%;2.63%;2.81%;8.31%;1.94%;7.69%;2.44%;8.51%;5.10%;5.29%;5.94%
90;Been convicted of a crime?;7.52%;12.28%;5.97%;3.01%;6.74%;9.63%;5.99%;7.17%;2.40%;7.55%;3.29%;8.84%;8.45%;14.87%;4.03%;5.78%;2.04%;12.34%;2.12%;5.55%;3.41%;2.88%;4.41%;1.97%;4.90%;3.35%;9.40%;6.36%;7.60%;7.26%
91;Been convicted of a felony?;3.46%;4.71%;2.49%;2.41%;3.16%;5.40%;2.84%;5.01%;1.08%;3.24%;2.93%;3.66%;3.49%;2.67%;1.50%;3.41%;0.75%;3.25%;0.48%;3.24%;3.09%;1.02%;1.76%;1.23%;2.86%;1.98%;4.09%;2.98%;3.33%;3.08%
92;Committed an act of vandalism?;40.07%;45.51%;43.36%;14.65%;48.56%;46.75%;36.57%;38.24%;11.74%;46.27%;42.35%;44.40%;48.95%;37.84%;44.05%;42.86%;39.78%;32.34%;8.53%;44.10%;35.32%;32.87%;31.31%;19.96%;19.42%;35.17%;42.99%;35.96%;41.26%;38.91%
93;Joined themile high club?;3.72%;4.28%;3.79%;4.10%;4.15%;5.85%;2.12%;3.28%;2.65%;4.13%;3.18%;3.68%;5.91%;2.06%;2.51%;4.70%;2.34%;2.79%;3.87%;5.12%;3.13%;1.22%;8.41%;1.87%;6.38%;2.76%;3.90%;3.06%;3.54%;3.33%
94;Participated in a “booty call” with a partner whom you were not in a relationship with?;24.79%;38.33%;26.15%;13.87%;28.35%;23.44%;17.80%;20.67%;9.15%;23.05%;20.93%;23.18%;26.46%;19.59%;26.66%;24.73%;29.81%;35.29%;9.69%;26.91%;19.87%;34.65%;23.10%;14.65%;37.76%;21.10%;28.85%;23.89%;27.12%;22.81%
95;Traveled 100 miles or more for the primary purpose of sexual intercourse?;8.88%;13.91%;7.29%;7.92%;11.08%;7.68%;10.01%;7.50%;9.40%;7.29%;12.02%;8.63%;11.70%;11.53%;11.01%;13.92%;10.41%;15.28%;3.93%;9.77%;7.56%;12.64%;15.23%;6.20%;15.38%;9.15%;12.47%;9.78%;8.29%;9.56%
96;Had sexual intercourse with a partner with an age gap of more than 3 years?;20.79%;33.42%;18.31%;23.23%;23.15%;14.67%;23.80%;19.64%;16.22%;15.59%;25.82%;23.62%;21.78%;19.27%;24.98%;20.13%;26.07%;33.54%;13.20%;20.82%;24.03%;28.23%;32.82%;32.30%;26.21%;21.63%;28.12%;24.43%;19.93%;23.05%
97;Had sexual intercourse with a virgin?;30.77%;39.25%;34.39%;21.19%;33.66%;29.21%;32.92%;30.78%;17.90%;25.65%;36.79%;28.86%;35.26%;33.87%;35.92%;29.00%;38.34%;42.24%;17.29%;26.68%;33.03%;35.15%;37.25%;29.13%;17.12%;30.11%;34.71%;29.84%;31.78%;30.33%
98;Had sexual intercourse without a condom?;37.97%;53.35%;41.80%;21.73%;42.17%;32.26%;36.63%;35.54%;23.26%;31.64%;41.10%;42.08%;40.34%;39.81%;38.17%;30.95%;40.07%;51.73%;17.49%;37.27%;36.75%;39.33%;51.38%;40.36%;32.41%;36.96%;43.97%;37.64%;40.13%;37.53%
99;Had an STD (sexually transmitted disease) test due to reasonable suspicion?;8.24%;14.54%;7.72%;10.46%;10.52%;7.44%;5.70%;7.57%;2.69%;6.28%;7.06%;13.41%;11.49%;5.97%;7.26%;9.09%;9.56%;20.95%;1.72%;5.28%;9.14%;11.18%;7.17%;11.90%;8.97%;5.07%;11.46%;8.79%;7.93%;8.57%
100;Had an STD?;4.94%;9.16%;4.04%;5.63%;5.75%;4.89%;3.76%;4.65%;2.20%;4.15%;8.60%;8.45%;6.10%;3.81%;3.43%;6.71%;4.91%;9.85%;1.00%;3.68%;6.12%;5.42%;0.99%;6.01%;7.69%;3.85%;6.64%;4.97%;4.84%;4.86%`;

const segments = {
    SORT_COUNTRY: "Sort by Country",
    COUNTRY: "Country",
    GENDER: "Gender",
    MOBILE_BRAND: "Mobile Brand"
};

const charts = {
    YES_NO: 0,
    COUNTRIES: 1
};

const c_light = '#4e6969';
const c_dark = '#333';
const c_border = '#9ff';
const AT = 500;

const categories = {
    "Country": {
        "category_columns": [
            "United States",
            "United Kingdom",
            "Japan",
            "Canada",
            "Australia",
            "Germany",
            "Netherlands",
            "Indonesia",
            "Ireland",
            "Italy",
            "Sweden",
            "New Zealand",
            "Finland",
            "Spain",
            "Israel",
            "Argentina",
            "France",
            "Thailand",
            "South Africa",
            "Brazil",
            "Mexico",
            "Russia",
            "South Korea",
            "Nigeria",
            "Portugal"
        ],
        "category_emoji_prefix": [
            "🇺🇸",
            "🇬🇧",
            "🇯🇵",
            "🇨🇦",
            "🇦🇺",
            "🇩🇪",
            "🇳🇱",
            "🇮🇩",
            "🇮🇪",
            "🇮🇹",
            "🇸🇪",
            "🇳🇿",
            "🇫🇮",
            "🇪🇸",
            "🇮🇱",
            "🇦🇷",
            "🇫🇷",
            "🇹🇭",
            "🇿🇦",
            "🇧🇷",
            "🇲🇽",
            "🇷🇺",
            "🇰🇷",
            "🇳🇬",
            "🇵🇹"
        ]
    },
    "Gender": {
        "category_columns": [
            "Male",
            "Female"
        ],
        "category_emoji_prefix": [
            "👨👨🏻👨🏼👨🏿",
            "👩👩🏻👩🏼👩🏿"
        ]
    },
    "Mobile Brand": {
        "category_columns": [
            "iPhone",
            "Android"
        ],
        "category_emoji_prefix": [
            "🍎",
            "🤖️"
        ]
    }
}

var processedData;
var selected = 1;
var segment = "Overall";
var width = Math.min(document.documentElement.clientWidth, 600);
var height = 600;
var lastChart = charts.YES_NO;

const drawYesNoChart = column => {
    if (column == null) {
        column = "Overall";
    }
    height = 600;
    const chart = d3.select(`#chart`)
        .attr("height", height);
    if (lastChart != charts.YES_NO) {
        chart.selectAll("*").remove();
        lastChart = charts.YES_NO;
    }
    const x = d3.scaleBand()
        .range([25, width - 25])
        .domain(["Yes", "No"])
        .padding(0.2);
    chart.append("g")
        .attr("class", "axis")
        .attr("transform", `translate(0,${height - 25})`)
        .call(d3.axisBottom(x));
    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - 25, 25]);
    const q = processedData.filter(d => d.qid === selected.toString())[0];
    const pct = parseFloat(q[column]);
    const data = [{
            name: "Yes",
            value: pct,
            text: `${pct}%`,
        },
        {
            name: "No",
            value: 100 - pct,
            text: `${Math.round((100 - pct) * 100) / 100}%`,
        },
    ];
    var barW = x.bandwidth();
    var overallData = [];
    if (column != "Overall") {
        barW = x.bandwidth() / 2;
        const overallPct = parseFloat(q["Overall"]);
        overallData = [{
                name: "Yes",
                value: overallPct,
                text: `${overallPct}%`,
            },
            {
                name: "No",
                value: 100 - overallPct,
                text: `${Math.round((100 - overallPct) * 100) / 100}%`,
            },
        ];
    }
    // selected segment bar
    chart.selectAll(".bars")
        .data(data)
        .join(
            bars => {
                bars.append("rect")
                    .attr("class", "bars")
                    .attr("x", d => x(d.name))
                    .attr("y", d => y(d.value))
                    .attr("width", barW)
                    .attr("height", d => height - 25 - y(d.value))
                    .attr("fill", c_light)
                    .style("stroke", c_border);
            },
            bars => {
                bars.transition().duration(AT)
                    .attr("x", d => x(d.name))
                    .attr("y", d => y(d.value))
                    .attr("width", barW)
                    .attr("height", d => height - 25 - y(d.value));
            }
        );
    // selected segment label
    chart.selectAll(".barstxt")
        .data(data)
        .join(
            txt => {
                txt.append("text")
                    .attr("class", "barstxt label")
                    .attr("x", d => x(d.name) + barW / 2)
                    .attr("y", d => y(d.value) - 25)
                    .attr("fill", c_border)
                    .style("text-anchor", "middle")
                    .text(d => d.text);
            },
            txt => {
                txt.transition().duration(AT)
                    .attr("x", d => x(d.name) + barW / 2)
                    .attr("y", d => y(d.value) - 25)
                    .text(d => d.text);
            },
            txt => txt.remove(),
        );
    // overall comparison bar
    chart.selectAll(".overall")
        .data(overallData)
        .join(
            bars => {
                bars.append("rect")
                    .attr("class", "overall")
                    .attr("x", d => x(d.name) + x.bandwidth() / 2)
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth() / 2)
                    .attr("height", d => height - 25 - y(d.value))
                    .attr("fill", c_dark)
                    .style("stroke", c_border);
            },
            bars => {
                bars.transition().duration(AT)
                    .attr("x", d => x(d.name) + x.bandwidth() / 2)
                    .attr("y", d => y(d.value))
                    .attr("height", d => height - 25 - y(d.value));
            },
            bars => bars.remove()
        );
    // overall comparison label
    chart.selectAll(".overalltxt")
        .data(overallData)
        .join(
            txt => {
                txt.append("text")
                    .attr("class", "overalltxt label")
                    .attr("x", d => x(d.name) + (x.bandwidth() * 0.75))
                    .attr("y", d => y(d.value) - 25)
                    .attr("fill", c_border)
                    .style("text-anchor", "middle")
                    .text(d => `🌍 ${d.text}`);
            }, txt => {
                txt.transition().duration(AT)
                    .attr("x", d => x(d.name) + (x.bandwidth() * 0.75))
                    .attr("y", d => y(d.value) - 25);
            },
            txt => txt.remove()
        );
};

const drawCountryChart = asc => {
    if (asc == null) {
        asc = false;
    }
    height = 900;
    const chart = d3.select(`#chart`)
        .attr("height", height);
    if (lastChart != charts.COUNTRIES) {
        chart.selectAll("*").remove();
        lastChart = charts.COUNTRIES;
    }
    var data = categories.Country.category_columns.map(
        (n, i) => ({
            country: n,
            emoji: categories.Country.category_emoji_prefix[i]
        })
    );
    // data.push({
    //     country: "Overall",
    //     emoji: "🌍"
    // });
    const q = processedData.filter(d => d.qid === selected.toString())[0];
    data.forEach(d => d.pct = parseFloat(q[d.country]));
    data.sort((a, b) => a.pct - b.pct);
    if (asc === false) {
        data = data.reverse();
    }
    const x = d3.scaleLinear()
        .domain([0, 100])
        .range([25, width - 25]);
    const y = d3.scaleBand()
        .range([25, height - 25])
        .domain(data.map(d => d.country))
        .padding(0.1);
    // horizontal bars
    chart.selectAll(".hbars")
        .data(data)
        .join(
            bars => {
                bars.append("rect")
                    .attr("class", "hbars")
                    .attr("x", x(0))
                    .attr("y", d => y(d.country))
                    .attr("width", d => x(d.pct))
                    .attr("height", y.bandwidth())
                    .attr("fill", c_light);
            },
            bars => {
                bars.transition().duration(AT)
                    .attr("x", x(0))
                    .attr("y", d => y(d.country))
                    .attr("width", d => x(d.pct));
            }
        );
    // fill the remainder of the space
    chart.selectAll(".hbars2")
        .data(data)
        .join(
            bars => {
                bars.append("rect")
                    .attr("class", "hbars2")
                    .attr("x", d => x(d.pct))
                    .attr("y", d => y(d.country))
                    .attr("width", d => x(100) - x(d.pct))
                    .attr("height", y.bandwidth())
                    .attr("fill", c_dark);
            },
            bars => {
                bars.transition().duration(AT)
                    .attr("x", d => x(d.pct))
                    .attr("y", d => y(d.country))
                    .attr("width", d => x(100) - x(d.pct));
            }
        );
    // label index and country
    chart.selectAll(".hbarstext")
        .data(data)
        .join(
            txt => {
                txt.append("text")
                    .attr("class", "hbarstext")
                    .attr("x", x(0) + 5)
                    .attr("y", d => y(d.country) + y.bandwidth() - 5)
                    .attr("fill", c_border)
                    .text((d, i) => `${i + 1}. ${d.country} ${d.emoji}`);
            },
            txt => {
                txt.transition().duration(AT)
                    .attr("x", x(0) + 5)
                    .attr("y", d => y(d.country) + y.bandwidth() - 5)
                    .text((d, i) => `${i + 1}. ${d.country} ${d.emoji}`);
            }
        );
    // label percentage
    chart.selectAll(".hbarstext2")
        .data(data)
        .join(
            txt => {
                txt.append("text")
                    .attr("class", "hbarstext2")
                    .attr("x", d => x(d.pct) + 5)
                    .attr("y", d => y(d.country) + y.bandwidth() - 5)
                    .attr("fill", c_border)
                    .text(d => `${d.pct}%`);
            },
            txt => {
                txt.transition().duration(AT)
                    .attr("x", d => x(d.pct) + 5)
                    .attr("y", d => y(d.country) + y.bandwidth() - 5)
                    .text(d => `${d.pct}%`);
            }
        );
    // mark overall percentage with line
    const overall = parseFloat(q.Overall);
    chart.selectAll(".line")
        .data([{
            val: overall
        }])
        .join(
            line => {
                line.append("line")
                    .attr("class", "line")
                    .attr("x1", d => x(d.val))
                    .attr("x2", d => x(d.val))
                    .attr("y1", 25)
                    .attr("y2", height - 25)
                    .attr("stroke", c_border);
            },
            line => {
                line.transition().duration(AT)
                    .attr("x1", d => x(d.val))
                    .attr("x2", d => x(d.val));
            }
        );
};

const drawChart = () => {
    switch (segment) {
        case "Ascending":
            drawCountryChart(true);
            break;
        case "Descending":
            drawCountryChart(false);
            break;
        case "Overall":
            drawYesNoChart();
            break;
        default:
            drawYesNoChart(segment);
    }
};

const setupVis = elementId => {
    const fmt = d3.dsvFormat(";");
    processedData = fmt.parse(rawData);
    const container = d3.select(`#${elementId}`);
    container.append("h1").text("Ultimate Rice Purity Test Stats Report");
    const questions = container.append("div")
        .attr("class", "wrp_quests");
    const selector = questions.append("input")
        .attr("class", "select_fld")
        .attr("id", "qSelector")
        .attr("type", "text")
        .attr("list", "qList")
        .attr("value", `${processedData[0].qid}. ${processedData[0].q_text}`);
    const list = container.append("datalist")
        .attr("id", "qList");
    list.selectAll(".qsOption")
        .data(processedData)
        .join(
            opts =>
            opts.append("option")
            .attr("value", d => `${d.qid}. ${d.q_text}`)
            .attr("class", ".qsOption")
            .text(d => `${d.qid}. ${d.q_text}`)
        );
    selector.on("click", _ => {
            selector.property("value", "");
        })
        .on("input", _ => {
            const val = selector.property("value");
            if (!qs[val]) {
                return;
            }
            const qid = parseInt(val);
            title.text(val);
            selected = qid;

            drawChart();
        });
    questions.append("div")
        .attr("class", "clear_fld")
        .text("▼")
        .on("click", _ => {
            selector.property("value", "");
            selector.node().focus();
    });
    questions.append("div")
        .attr("class", "next_fld")
        .text("❯")
        .on("click", _ => {
            const idx = selected;
            const q = processedData[idx];
            const text = `${q.qid}. ${q.q_text}`;
            selector.property("value", text);
            title.text(text);
            selected = selected + 1;
            selector.node().focus();
            drawChart();
        });
    questions.append("div")
        .attr("class", "prev_fld")
        .text("❮")
        .on("click", _ => {
            const idx = selected - 2;
            const q = processedData[idx];
            const text = `${q.qid}. ${q.q_text}`;
            selector.property("value", text);
            title.text(text);
            selected = selected - 1;
            selector.node().focus();
            drawChart();
        });
    container.append("br");
    container.append("br");
    container.append("label")
        .attr("for", "segment")
        .text("Filter Responses:");
    const segmentSelector = container.append("select")
        .attr("id", "segmentSelector")
        .attr("name", "segment");
    const title = container.append("h2")
        .style("text-align", "center")
        .text(`${processedData[0].qid}. ${processedData[0].q_text}`);
    const qs = {};
    processedData.forEach(d => {
        qs[`${d.qid}. ${d.q_text}`] = true;
    });
    segmentSelector.on("change", _ => {
        segment = segmentSelector.property("value");
        drawChart();
    });
    segmentSelector.append("option")
        .text("Overall")
        .property("value", "Overall");
    for (const [_, value] of Object.entries(segments)) {
        const group = segmentSelector.append("optgroup")
            .attr("label", value);
        if (value === segments.SORT_COUNTRY) {
            group.append("option")
                .text("Descending")
                .property("value", "Descending");
            group.append("option")
                .text("Ascending")
                .property("value", "Ascending");
        } else {
            const categoryValues = categories[value];
            categoryValues.category_columns.forEach((d, i) => {
                group.append("option")
                    .text(`${d} ${categoryValues.category_emoji_prefix[i]}`)
                    .property("value", d);
            });
        }
    }
    container.append("svg")
        .attr("id", "chart")
        .attr("width", width)
        .attr("height", height);
    drawChart();
};